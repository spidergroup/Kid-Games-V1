<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Challenge! | Pet Memory Game for Kids</title>
    <meta name="description" content="Play Memory Challenge! A fun, interactive pet memory game for kids. Improve memory, focus, and have fun with cute animal cards and exciting animations.">
    <meta name="keywords" content="memory game, kids game, pet game, animal game, brain game, memory challenge, educational game, fun, interactive, browser game, free game">
    <meta name="author" content="Kid Games">
    <meta property="og:title" content="Memory Challenge! | Pet Memory Game for Kids">
    <meta property="og:description" content="A fun, interactive pet memory game for kids. Improve memory, focus, and have fun with cute animal cards and exciting animations.">
    <meta property="og:image" content="og-image.png">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourdomain.com/memory-challenge.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Memory Challenge! | Pet Memory Game for Kids">
    <meta name="twitter:description" content="A fun, interactive pet memory game for kids. Improve memory, focus, and have fun with cute animal cards and exciting animations.">
    <meta name="twitter:image" content="og-image.png">
    <link rel="canonical" href="https://yourdomain.com/memory-challenge.html">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-J0PVJ95F71"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-J0PVJ95F71');
    </script>
    <style>
        :root {
            --mc-orange: #FF6F00;
            --mc-blue: #005A9C;
            --mc-yellow: #f1c40f; /* Game title & active borders */
            --font-family-main: 'Fredoka', sans-serif;
            --bg-gradient-start: #2c3e50;
            --bg-gradient-end: #4ca1af;
            --text-light: #f0e68c;
            --white: #FFFFFF;
            --black: #000000;
            --card-purple: #8A2BE2;
            --card-blue: #007BFF;
        }

        body {
            font-family: var(--font-family-main);
            background-image: linear-gradient(to bottom, var(--bg-gradient-start), var(--bg-gradient-end));
            color: var(--white);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 15px;
            box-sizing: border-box;
            overflow-x: hidden;
        }

        .game-title-main {
            font-size: 2.5rem;
            font-weight: 600;
            color: var(--mc-yellow);
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .menus-wrapper {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            max-width: 440px; /* Adjusted for simpler menu */
            margin-bottom: 15px;
        }

        .menu-container {
            padding: 10px 15px;
            border-radius: 12px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .menu-title {
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 10px;
            color: var(--text-light);
        }

        .level-menu {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
        }

        .menu-button {
            padding: 8px 15px;
            border-radius: 20px;
            border: 2px solid transparent;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            background-color: var(--mc-orange);
            color: var(--white);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .menu-button:hover:not(.active) {
            background-color: #e65c00;
            transform: translateY(-2px);
        }
        .menu-button.active {
            font-weight: 600;
            transform: scale(1.05);
            background-color: var(--mc-blue);
            border-color: var(--mc-yellow);
            color: var(--white);
        }

        #game-interaction-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 600px;
            margin: 0 auto 10px auto;
        }

        #action-button-container {
            text-align: center;
            margin-bottom: 8px;
        }

        #message-area {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-light);
            height: 25px;
            text-align: center;
            margin-bottom: 10px;
        }
        
        #actionButton {
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 25px;
            background-color: #2ecc71;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            min-width: 150px;
        }
        #actionButton:hover:not(:disabled) { background-color: #27ae60; }
        #actionButton:disabled { background-color: #9ca3af; cursor: not-allowed; opacity: 0.7; }        
        .game-board-shell {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* Always 2x2 for 4 cards */
            gap: 10px;
            width: 290px; /* (140 * 2) + 10 gap */
            height: 290px; /* (140 * 2) + 10 gap */
            margin: 15px auto;
            position: relative;
            justify-self: center;
        }

        .card-shell {
            width: 140px; 
            height: 140px; 
            perspective: 1000px;
            cursor: pointer;
            transition: transform 0.6s, top 0.5s ease-in-out, left 0.5s ease-in-out, opacity 0.3s;
            margin-left: auto;
            margin-right: auto;
        }
        .card-shell-inner {
            position: relative; width: 100%; height: 100%; text-align: center;
            transition: transform 0.5s ease-in-out; transform-style: preserve-3d;
            border: 3px solid var(--mc-yellow); border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.1);
        }
        .card-shell.flipped .card-shell-inner { transform: rotateY(180deg); }
        .card-shell.target-revealed .card-shell-inner { transform: rotateY(0deg); }
        .card-shell.incorrect-revealed .card-shell-inner { transform: rotateY(0deg); animation: shake 0.5s; }

        .card-shell-face {
            position: absolute; width: 100%; height: 100%; border-radius: 7px;
            display: flex; align-items: center; justify-content: center; padding: 0px;
            backface-visibility: hidden; -webkit-backface-visibility: hidden;
        }
        .card-shell-front { /* Shows the vehicle */ }
        .card-shell-back { 
            background-color: var(--mc-blue);
            transform: rotateY(180deg);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text x="50%" y="55%" dominant-baseline="middle" text-anchor="middle" font-size="70" fill="rgba(255,255,255,0.8)" style="filter: drop-shadow(1px 1px 1px rgba(0,0,0,0.4));">?</text></svg>');
            background-size: 60%;
            background-repeat: no-repeat;
            background-position: center;
        }
        .card-svg { width: 90%; height: 90%; object-fit: contain; }
        .bg-purple { background-color: var(--card-purple); } 
        .bg-blue { background-color: var(--card-blue); }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.7); display: none;
            justify-content: center; align-items: center; z-index: 1000;
            opacity: 0; transition: opacity 0.3s ease-in-out;
        }
        .modal-overlay.show { display: flex; opacity: 1; }
        .modal-content {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            padding: 2rem 3rem; border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); text-align: center;
            transform: scale(0.7); transition: transform 0.3s ease-in-out;
        }
        .modal-overlay.show .modal-content { transform: scale(1); }
        .modal-content h2 { color: white; font-size: 2rem; margin: 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }

        a.home-button {
            display: inline-block; margin-top: 20px; padding: 10px 20px;
            background-color: #e74c3c; color: white; text-decoration: none;
            border-radius: 20px; font-size: 1rem; font-weight: 500;
            box-shadow: 0 3px #c0392b;
        }
        a.home-button:active { transform: translateY(1px); box-shadow: 0 2px #c0392b; }

        /* --- Firework Animation --- */
        .firework {
            position: fixed;
            left: 0; top: 0; width: 100vw; height: 100vh;
            pointer-events: none;
            z-index: 2000;
        }
        .firework > .before, .firework > .after {
            position: absolute;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            content: '';
            box-shadow: 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff, 0 0 #fff;
            animation: bang 1s ease-out forwards, gravity 1s ease-in forwards, position 5s linear forwards;
        }
        .firework > .after {
            animation-delay: 1.25s, 1.25s, 1.25s;
            animation-duration: 1.25s, 1.25s, 6.25s;
        }
        @keyframes bang {
            to {
                box-shadow:
                    0 0 #fff,
                    50px -80px hsl(0,100%,50%),
                    -60px -60px hsl(30,100%,50%),
                    80px 0 hsl(60,100%,50%),
                    -80px 0 hsl(90,100%,50%),
                    60px 60px hsl(120,100%,50%),
                    -50px 80px hsl(150,100%,50%),
                    0 90px hsl(180,100%,50%),
                    0 -90px hsl(210,100%,50%),
                    90px 0 hsl(240,100%,50%),
                    -90px 0 hsl(270,100%,50%),
                    70px 70px hsl(300,100%,50%),
                    -70px 70px hsl(330,100%,50%),
                    30px -100px hsl(45,100%,50%),
                    -30px -100px hsl(75,100%,50%),
                    100px 30px hsl(105,100%,50%),
                    -100px 30px hsl(135,100%,50%),
                    100px -30px hsl(165,100%,50%),
                    -100px -30px hsl(195,100%,50%),
                    30px 100px hsl(225,100%,50%),
                    -30px 100px hsl(255,100%,50%),
                    60px -90px hsl(285,100%,50%),
                    -60px -90px hsl(315,100%,50%),
                    90px 60px hsl(345,100%,50%),
                    -90px 60px hsl(15,100%,50%),
                    0 0 #fff;
            }
        }
        @keyframes gravity {
            to {
                transform: translateY(200px);
                opacity: 0;
            }
        }
        @keyframes position {
            0%, 19.9% {
                margin-top: 10%;
                margin-left: 40%;
            }
            20%, 39.9% {
                margin-top: 40%;
                margin-left: 30%;
            }
            40%, 59.9% {
                margin-top: 20%;
                margin-left: 70%;
            }
            60%, 79.9% {
                margin-top: 30%;
                margin-left: 20%;
            }
            80%, 99.9% {
                margin-top: 30%;
                margin-left: 80%;
            }
        }

        @keyframes pulse-mc {
            0%, 100% { box-shadow: 0 0 8px var(--mc-yellow), 0 0 15px var(--mc-yellow); transform: scale(1); }
            50% { box-shadow: 0 0 15px var(--mc-yellow), 0 0 25px var(--mc-yellow); transform: scale(1.03); }
        }
        .highlight-mc-target .card-shell-inner { animation: pulse-mc 1s infinite alternate; }
        @keyframes shake {
            0%, 100% { transform: translateX(0) rotateY(0deg); }
            25% { transform: translateX(-5px) rotateY(0deg); }
            50% { transform: translateX(5px) rotateY(0deg); }
            75% { transform: translateX(-5px) rotateY(0deg); }
        }        /* Responsive adjustments for shell game board */
         @media (min-width: 380px) { /* Slightly larger cards */
            .game-board-shell { width: 330px; height: 330px; }
            .card-shell { width: 160px; height: 160px; }
        }
        @media (min-width: 640px) { /* Even larger for wider screens */
            .game-board-shell { width: 440px; height: 440px; }
            .card-shell { width: 200px; height: 200px; }
        }


        #innerGameSection {  
            
        }

        #outerGameSection {
            width:100%;
            display: flex;
            justify-content: center;
        }

        #innerGameSection .game-board-shell {
            justify-content: center;
        }

        
        
    </style>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>    <h1 class="game-title-main">Memory Challenge</h1>

    <div class="game-desc" style="max-width: 500px; margin: 0 auto 18px auto; color: #f0e68c; font-size: .9rem; text-align: center;">
        Test your memory and attention!<br>
        <b>How to play:</b> Watch as four cute pet cards are shuffled. Remember the position of the highlighted pet, then try to find it after the shuffle!<br>
        <ul style="margin: 10px 0 0 0; padding-left: 1.2em; text-align: left; display: inline-block;">
            <li>Choose your difficulty and press <b>Start Game</b>.</li>
            <li>All cards are revealed. Memorize the highlighted pet!</li>
            <li>The cards are flipped and shuffled.</li>
            <li>Try to click the card that matches the target pet.</li>
            <li>Celebrate your win with fireworks, or try again!</li>
        </ul>
        <br/>
        Play as many times as you like!
    </div>

    <div class="menus-wrapper">
        <div class="menu-container level-menu-container">
            <h2 class="menu-title">Select Difficulty:</h2>
            <div class="level-menu" id="levelMenuContainer"></div>
        </div>
    </div>

    <div id="game-interaction-area">
        <div id="message-area">Select difficulty and click Start!</div>
        <div id="action-button-container">
            <button id="actionButton">Start Game</button>
        </div>
    </div>

    <div id="outerGameSection">
        <div id="innerGameSection">
            <div id="gameBoardShell" class="game-board-shell"></div>
        </div>
    </div>
    

    <div id="winModalOverlay" class="modal-overlay">
        <div class="modal-content">
            <h2 id="winModalMessage">You found it!</h2>
        </div>
    </div>
    
    <script>        const gameBoard = document.getElementById('gameBoardShell');
        const levelMenuContainer = document.getElementById('levelMenuContainer');
        const actionButton = document.getElementById('actionButton');
        const messageArea = document.getElementById('message-area');
        const winModalOverlay = document.getElementById('winModalOverlay');
        const winModalMessage = document.getElementById('winModalMessage');

        // --- GAME LOGIC REPLACEMENT START ---
        const petDefinitions = [
            { id: 'bird', name: 'Bird', imageSrc: 'memory-game-assets/pets/bird.jpg' },
            { id: 'bunny', name: 'Bunny', imageSrc: 'memory-game-assets/pets/bunny.jpg' },
            { id: 'cat', name: 'Cat', imageSrc: 'memory-game-assets/pets/cat.jpg' },
            { id: 'dog', name: 'Dog', imageSrc: 'memory-game-assets/pets/dog.jpg' },
            { id: 'ferret', name: 'Ferret', imageSrc: 'memory-game-assets/pets/ferret.jpg' },                                                                                                                                                                                                                                                                                                                                     
            { id: 'fish', name: 'Fish', imageSrc: 'memory-game-assets/pets/fish.jpg' },
            { id: 'guinea-pig', name: 'Guinea Pig', imageSrc: 'memory-game-assets/pets/guinea-pig.jpg' },
            { id: 'hamster', name: 'Hamster', imageSrc: 'memory-game-assets/pets/hamster.jpg' },
            { id: 'lizard', name: 'Lizard', imageSrc: 'memory-game-assets/pets/lizard.jpg' },
            { id: 'mouse', name: 'Mouse', imageSrc: 'memory-game-assets/pets/mouse.jpg' },
            { id: 'parrot', name: 'Parrot', imageSrc: 'memory-game-assets/pets/parrot.jpg' },
            { id: 'turtle', name: 'Turtle', imageSrc: 'memory-game-assets/pets/turtle.jpg' }
        ];

        const LEVELS = {
            easy:   { name: 'Easy', rows: 2, cols: 2, shuffles: 7, shuffleSpeed: 500 },
            medium: { name: 'Medium', rows: 2, cols: 2, shuffles: 15, shuffleSpeed: 250 }, // 1.5x faster than easy
            hard:   { name: 'Hard', rows: 2, cols: 2, shuffles: 25, shuffleSpeed: 200 }    // 2x faster than medium
        };
        let currentLevelKey = 'easy';
        let currentDifficulty = LEVELS[currentLevelKey];
        let cardsOnBoard = [];
        let targetPet = null;
        let canClickCard = false;
        let gameActive = false;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function createLevelButtons() {
            Object.keys(LEVELS).forEach(key => {
                const level = LEVELS[key];
                const button = document.createElement('button');
                button.id = `level-${key}-button`;
                button.classList.add('menu-button');
                if (key === currentLevelKey) button.classList.add('active');
                button.textContent = level.name;
                button.addEventListener('click', () => selectLevel(key));
                levelMenuContainer.appendChild(button);
            });
        }

        function selectLevel(levelKey) {
            if (gameActive) return;
            currentLevelKey = levelKey;
            currentDifficulty = LEVELS[currentLevelKey];
            Array.from(levelMenuContainer.children).forEach(btn => {
                btn.classList.toggle('active', btn.id === `level-${levelKey}-button`);
            });
            resetGameUI();
        }

        function createCardElement(pet, id) {
            const card = document.createElement('div');
            card.className = 'card-shell';
            card.dataset.id = pet.id;
            card.dataset.name = pet.name;
            card.dataset.index = id;

            const cardInner = document.createElement('div');
            cardInner.className = 'card-shell-inner';

            const cardFront = document.createElement('div');
            cardFront.className = 'card-shell-face card-shell-front bg-blue';
            const img = document.createElement('img');
            img.src = pet.imageSrc;
            img.alt = pet.name;
            img.className = 'card-svg';
            cardFront.appendChild(img);

            const cardBack = document.createElement('div');
            cardBack.className = 'card-shell-face card-shell-back';

            cardInner.appendChild(cardFront);
            cardInner.appendChild(cardBack);
            card.appendChild(cardInner);

            card.addEventListener('click', () => handleCardClick(card));
            return card;
        }

        function setupBoard_for_Init() {
            messageArea.textContent = "Getting ready...";
            actionButton.disabled = true;
            gameBoard.innerHTML = '';
            cardsOnBoard = [];

            const numCards = currentDifficulty.rows * currentDifficulty.cols;
            const availablePets = shuffleArray([...petDefinitions]);
            const petsForGame = availablePets.slice(0, numCards);
            targetPet = petsForGame[Math.floor(Math.random() * petsForGame.length)];

            // Set grid
            gameBoard.style.gridTemplateColumns = `repeat(${currentDifficulty.cols}, 1fr)`;
            gameBoard.style.gridTemplateRows = `repeat(${currentDifficulty.rows}, 1fr)`;

            petsForGame.forEach((pet, idx) => {
                const card = createCardElement(pet, idx);
                cardsOnBoard.push(card);
                gameBoard.appendChild(card);
            });

            cardsOnBoard.forEach(card => card.classList.add('flipped'));
        }

        function setupBoard() {
            messageArea.textContent = "Getting ready...";
            actionButton.disabled = true;
            gameBoard.innerHTML = '';
            cardsOnBoard = [];

            const numCards = currentDifficulty.rows * currentDifficulty.cols;
            const availablePets = shuffleArray([...petDefinitions]);
            const petsForGame = availablePets.slice(0, numCards);
            targetPet = petsForGame[Math.floor(Math.random() * petsForGame.length)];

            // Set grid
            gameBoard.style.gridTemplateColumns = `repeat(${currentDifficulty.cols}, 1fr)`;
            gameBoard.style.gridTemplateRows = `repeat(${currentDifficulty.rows}, 1fr)`;

            petsForGame.forEach((pet, idx) => {
                const card = createCardElement(pet, idx);
                cardsOnBoard.push(card);
                gameBoard.appendChild(card);
            });
            cardsOnBoard.forEach(card => card.classList.remove('flipped'));

            setTimeout(() => highlightTargetCard(), 1200);
        }

        function highlightTargetCard() {
            messageArea.textContent = `Find the ${targetPet.name}!`;
            const targetCard = cardsOnBoard.find(card => card.dataset.id === targetPet.id);
            if (targetCard) {
                targetCard.classList.add('highlight-mc-target');
            }
            setTimeout(() => {
                if (targetCard) targetCard.classList.remove('highlight-mc-target');
                flipAllToBackAndPrepareShuffle();
            }, 2000);
        }

        function flipAllToBackAndPrepareShuffle() {
            messageArea.textContent = 'Watch closely...';
            cardsOnBoard.forEach(card => card.classList.add('flipped'));
            setTimeout(() => startShuffleAnimation(), 1000);
        }

        async function startShuffleAnimation() {
            messageArea.textContent = 'Shuffling!';
            let cardPositions = cardsOnBoard.map(card => card.getBoundingClientRect());
            let boardRect = gameBoard.getBoundingClientRect();
            // Set absolute positions for animation
            cardsOnBoard.forEach((card, idx) => {
                card.style.position = 'absolute';
                card.style.left = `${cardPositions[idx].left - boardRect.left}px`;
                card.style.top = `${cardPositions[idx].top - boardRect.top}px`;
                card.style.transition = 'left 0.5s, top 0.5s';
            });
            await new Promise(r => setTimeout(r, 50));
            for (let i = 0; i < currentDifficulty.shuffles; i++) {
                let idx1 = Math.floor(Math.random() * cardsOnBoard.length);
                let idx2 = Math.floor(Math.random() * cardsOnBoard.length);
                while (idx1 === idx2) idx2 = Math.floor(Math.random() * cardsOnBoard.length);
                // Swap positions
                let tempLeft = cardsOnBoard[idx1].style.left;
                let tempTop = cardsOnBoard[idx1].style.top;
                cardsOnBoard[idx1].style.left = cardsOnBoard[idx2].style.left;
                cardsOnBoard[idx1].style.top = cardsOnBoard[idx2].style.top;
                cardsOnBoard[idx2].style.left = tempLeft;
                cardsOnBoard[idx2].style.top = tempTop;
                [cardsOnBoard[idx1], cardsOnBoard[idx2]] = [cardsOnBoard[idx2], cardsOnBoard[idx1]];
                await new Promise(r => setTimeout(r, currentDifficulty.shuffleSpeed));
            }
            // Reset to grid
            gameBoard.innerHTML = '';
            cardsOnBoard.forEach(card => {
                card.style.position = '';
                card.style.left = '';
                card.style.top = '';
                card.style.transition = '';
                gameBoard.appendChild(card);
            });
            canClickCard = true;
            messageArea.textContent = `Where is the ${targetPet.name}? Click a card!`;
        }

        function handleCardClick(card) {
            if (!canClickCard) return;
            canClickCard = false;
            card.classList.remove('flipped');
            if (card.dataset.id === targetPet.id) {
                card.classList.add('target-revealed');
                messageArea.textContent = `Yeah! You found the ${targetPet.name}!`;
                winModalMessage.textContent = `You found the ${targetPet.name}!`;
                // Firework animation
                const fireworks = [];
                for (let i = 0; i < 3; i++) {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.innerHTML = '<div class="before"></div><div class="after"></div>';
                    firework.style.animationDelay = `${i * 0.2}s`;
                    document.body.appendChild(firework);
                    fireworks.push(firework);
                }
                winModalOverlay.classList.add('show');
                setTimeout(() => {
                    winModalOverlay.classList.remove('show');
                    fireworks.forEach(fw => { if (fw.parentNode) fw.parentNode.removeChild(fw); });
                    resetGameUI('Play Again?');
                }, 2500);
            } else {
                card.classList.add('incorrect-revealed');
                messageArea.textContent = `Oops! That's not the ${targetPet.name}.`;
                setTimeout(() => {
                    const correctCard = cardsOnBoard.find(c => c.dataset.id === targetPet.id && c !== card);
                    if (correctCard) {
                        correctCard.classList.remove('flipped');
                        correctCard.classList.add('target-revealed', 'highlight-mc-target');
                    }
                    setTimeout(() => {
                        if (correctCard) {
                            correctCard.classList.remove('highlight-mc-target');
                            if(card.dataset.id !== targetPet.id) {
                                correctCard.classList.add('flipped');
                                correctCard.classList.remove('target-revealed');
                            }
                        }
                        card.classList.add('flipped');
                        card.classList.remove('incorrect-revealed');
                        resetGameUI('Try Again?');
                    }, 2000);
                }, 1500);
            }
        }

        function resetGameUI(buttonText = "Start Game") {
            gameActive = false;
            canClickCard = false;
            actionButton.textContent = buttonText;
            actionButton.disabled = false;
            if (buttonText === "Start Game" || buttonText === "Play Again?" || buttonText === "Try Again?") {
                messageArea.textContent = "Select difficulty and click Start!";
                if (buttonText === "Try Again?") messageArea.textContent = "Give it another go!";
            }
        }

        actionButton.addEventListener('click', () => {
            if (actionButton.textContent === "Start Game" || actionButton.textContent === "Play Again?" || actionButton.textContent === "Try Again?") {
                gameActive = true;
                setupBoard();
            }
        });

        createLevelButtons();
        setupBoard_for_Init();
        resetGameUI();
        messageArea.textContent = "Select difficulty and click Start!";
        // --- GAME LOGIC REPLACEMENT END ---
    </script>
    <a href="index.html" class="home-button">
        🏠 Back to Main Menu
    </a>
</body>
</html>